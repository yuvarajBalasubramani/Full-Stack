# ğŸ—ï¸ Payment & Tracking Architecture

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Product    â”‚  â”‚     Cart     â”‚  â”‚   Checkout   â”‚         â”‚
â”‚  â”‚    Grid      â”‚â†’ â”‚   Component  â”‚â†’ â”‚   Enhanced   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                              â”‚                   â”‚
â”‚                                              â†“                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚           Payment Method Selection                    â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚  [Google Pay] [COD] [Card] [UPI]                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                 â”‚                                                â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚        â†“                 â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ Google   â”‚      â”‚   COD    â”‚                               â”‚
â”‚  â”‚   Pay    â”‚      â”‚ Payment  â”‚                               â”‚
â”‚  â”‚ Service  â”‚      â”‚  Direct  â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚       â”‚                 â”‚                                       â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                â†“                                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚         â”‚   Order     â”‚                                        â”‚
â”‚         â”‚   Created   â”‚                                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                â”‚                                                â”‚
â”‚                â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚           Order Tracking Component                    â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚     â”‚
â”‚  â”‚  â”‚   Google   â”‚  â”‚   Order    â”‚  â”‚  Status    â”‚    â”‚     â”‚
â”‚  â”‚  â”‚    Maps    â”‚  â”‚  Details   â”‚  â”‚  Timeline  â”‚    â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND (Node.js/Express)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              Order Controller                         â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚  â€¢ createOrder()                                     â”‚      â”‚
â”‚  â”‚  â€¢ getOrders()                                       â”‚      â”‚
â”‚  â”‚  â€¢ cancelOrder()                                     â”‚      â”‚
â”‚  â”‚  â€¢ updateOrderStatus()                               â”‚      â”‚
â”‚  â”‚  â€¢ updateDeliveryTracking()                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                       â”‚                                          â”‚
â”‚                       â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              Order Model (MongoDB)                    â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚  â€¢ Order details                                     â”‚      â”‚
â”‚  â”‚  â€¢ Payment info (method, status, token)              â”‚      â”‚
â”‚  â”‚  â€¢ Shipping address (with coordinates)               â”‚      â”‚
â”‚  â”‚  â€¢ Delivery tracking (location, person)              â”‚      â”‚
â”‚  â”‚  â€¢ Cancellation info (deadline, refund)              â”‚      â”‚
â”‚  â”‚  â€¢ Status history (timeline)                         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL SERVICES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Google     â”‚  â”‚   Google     â”‚  â”‚   Payment    â”‚         â”‚
â”‚  â”‚   Maps API   â”‚  â”‚   Pay API    â”‚  â”‚   Gateway    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Payment Flow Diagrams

### Google Pay Payment Flow

```
User                    Frontend                Backend              Google Pay
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  1. Select Google Pay   â”‚                       â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  2. Click Place Order   â”‚                       â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  3. Load Google Pay   â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  4. Show Payment Sheetâ”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  5. Authorize Payment   â”‚                       â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  6. Get Payment Token â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  7. Return Token      â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  8. Create Order      â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
 â”‚                         â”‚     (with token)      â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  9. Order Created     â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                         â”‚   (status: confirmed) â”‚                     â”‚
 â”‚                         â”‚   (payment: completed)â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  10. Show Success       â”‚                       â”‚                     â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
```

### Cash on Delivery Flow

```
User                    Frontend                Backend              Delivery
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  1. Select COD          â”‚                       â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  2. Click Place Order   â”‚                       â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  3. Create Order      â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
 â”‚                         â”‚   (method: cod)       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  4. Order Created     â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                         â”‚   (status: confirmed) â”‚                     â”‚
 â”‚                         â”‚   (payment: pending)  â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  5. Show Success        â”‚                       â”‚                     â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                     â”‚
 â”‚  "Keep â‚¹XXX ready"      â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚         ... Order Processing & Shipping ...     â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚  6. Deliver Order   â”‚
 â”‚                         â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  7. Pay Cash            â”‚                       â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚  8. Confirm Payment â”‚
 â”‚                         â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  9. Update Status     â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                         â”‚   (status: delivered) â”‚                     â”‚
 â”‚                         â”‚   (payment: completed)â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
```

---

## Order Tracking Flow

### Real-Time Tracking

```
User                    Frontend                Backend              Google Maps
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  1. Click Track Order   â”‚                       â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  2. Get Order Details â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  3. Return Order      â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                         â”‚   (with tracking data)â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  4. Load Maps API     â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  5. Initialize Map    â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  6. Add Markers       â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚   (delivery location) â”‚                     â”‚
 â”‚                         â”‚   (destination)       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  7. Draw Route        â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  8. Calculate Distanceâ”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  9. View Live Map       â”‚                       â”‚                     â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                     â”‚
 â”‚  (with route & markers) â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚         ... Delivery Person Updates Location ...â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  10. Poll for Updates â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
 â”‚                         â”‚   (every 30 seconds)  â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  11. New Location     â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  12. Update Marker    â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚   (animate movement)  â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  13. See Updated Map    â”‚                       â”‚                     â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
```

---

## Order Cancellation Flow

### Within 1 Hour

```
User                    Frontend                Backend              Payment Gateway
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  1. Click Cancel Order  â”‚                       â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  2. Confirm Cancellationâ”‚                       â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  3. Cancel Request    â”‚                     â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
 â”‚                         â”‚   (orderId, reason)   â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  4. Check Time Window â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                         â”‚   (< 1 hour? âœ…)      â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  5. Check Payment     â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                         â”‚   (paid online? âœ…)   â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚  6. Initiate Refund â”‚
 â”‚                         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚  7. Refund Pending  â”‚
 â”‚                         â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  8. Order Cancelled   â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                         â”‚   (status: cancelled) â”‚                     â”‚
 â”‚                         â”‚   (refund: pending)   â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚  9. Show Confirmation   â”‚                       â”‚                     â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                     â”‚
 â”‚  "Refund in 5-7 days"   â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚         ... 5-7 Business Days ...               â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚                       â”‚  10. Refund Completeâ”‚
 â”‚                         â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                         â”‚                       â”‚                     â”‚
 â”‚                         â”‚  11. Update Status    â”‚                     â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                         â”‚   (refund: completed) â”‚                     â”‚
 â”‚                         â”‚                       â”‚                     â”‚
```

### After 1 Hour (Rejected)

```
User                    Frontend                Backend
 â”‚                         â”‚                       â”‚
 â”‚  1. Click Cancel Order  â”‚                       â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
 â”‚                         â”‚                       â”‚
 â”‚                         â”‚  2. Cancel Request    â”‚
 â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                         â”‚                       â”‚
 â”‚                         â”‚  3. Check Time Window â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                         â”‚   (> 1 hour? âŒ)      â”‚
 â”‚                         â”‚                       â”‚
 â”‚                         â”‚  4. Reject Request    â”‚
 â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                         â”‚   (400 Error)         â”‚
 â”‚                         â”‚                       â”‚
 â”‚  5. Show Error          â”‚                       â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
 â”‚  "Cancellation window   â”‚                       â”‚
 â”‚   has expired"          â”‚                       â”‚
 â”‚                         â”‚                       â”‚
```

---

## Database Schema

### Order Document Structure

```javascript
{
  _id: ObjectId("..."),
  user: ObjectId("..."),
  
  // Order Items
  items: [
    {
      product: ObjectId("..."),
      quantity: 2,
      price: 999.00
    }
  ],
  
  // Pricing
  subtotal: 1998.00,
  shipping: 50.00,
  tax: 368.64,
  total: 2416.64,
  
  // Status
  status: "confirmed",  // pending, confirmed, preparing, shipped, 
                        // out_for_delivery, delivered, cancelled, refunded
  
  statusHistory: [
    {
      status: "pending",
      timestamp: ISODate("2024-01-15T10:00:00Z"),
      note: "Order created"
    },
    {
      status: "confirmed",
      timestamp: ISODate("2024-01-15T10:01:00Z"),
      note: "Payment successful"
    }
  ],
  
  // Shipping Address
  shippingAddress: {
    fullName: "John Doe",
    email: "john@example.com",
    phone: "+919876543210",
    address: "123 Main Street, Apartment 4B",
    city: "Mumbai",
    state: "Maharashtra",
    pincode: "400001",
    country: "India",
    coordinates: {
      lat: 19.0760,
      lng: 72.8777
    }
  },
  
  // Payment Information
  paymentInfo: {
    method: "googlepay",  // googlepay, cod, card, upi, wallet
    status: "completed",   // pending, completed, failed, refunded
    transactionId: "TXN123456789",
    googlePayToken: "encrypted_token_here",
    cardLast4: null,
    upiId: null
  },
  
  // Delivery Tracking
  deliveryTracking: {
    currentLocation: {
      lat: 19.0760,
      lng: 72.8777
    },
    deliveryPersonName: "Rajesh Kumar",
    deliveryPersonPhone: "+919876543210",
    estimatedDelivery: ISODate("2024-01-22T18:00:00Z"),
    actualDelivery: null,
    trackingUpdates: [
      {
        location: {
          lat: 19.0760,
          lng: 72.8777
        },
        status: "shipped",
        timestamp: ISODate("2024-01-16T10:00:00Z"),
        note: "Package picked up from warehouse"
      }
    ]
  },
  
  // Cancellation Information
  cancellationInfo: {
    canCancel: true,
    cancelDeadline: ISODate("2024-01-15T11:00:00Z"),  // 1 hour after creation
    cancelledAt: null,
    cancelReason: null,
    refundStatus: "not_applicable",  // not_applicable, pending, processing, completed
    refundAmount: null
  },
  
  // Timestamps
  createdAt: ISODate("2024-01-15T10:00:00Z"),
  updatedAt: ISODate("2024-01-15T10:01:00Z")
}
```

---

## Component Hierarchy

```
App
â”œâ”€â”€ Navigation
â”‚   â””â”€â”€ Cart Badge (shows item count)
â”‚
â”œâ”€â”€ ProductGrid
â”‚   â””â”€â”€ ProductCard (multiple)
â”‚       â””â”€â”€ Add to Cart Button
â”‚
â”œâ”€â”€ Cart (Sidebar)
â”‚   â”œâ”€â”€ Cart Items
â”‚   â””â”€â”€ Checkout Button
â”‚
â”œâ”€â”€ CheckoutEnhanced
â”‚   â”œâ”€â”€ Order Summary Panel
â”‚   â”‚   â”œâ”€â”€ Cart Items List
â”‚   â”‚   â””â”€â”€ Price Breakdown
â”‚   â”‚
â”‚   â””â”€â”€ Checkout Form Panel
â”‚       â”œâ”€â”€ Step 1: Shipping Information
â”‚       â”‚   â”œâ”€â”€ Name, Email, Phone
â”‚       â”‚   â””â”€â”€ Address Fields
â”‚       â”‚
â”‚       â””â”€â”€ Step 2: Payment Information
â”‚           â”œâ”€â”€ Payment Method Selector
â”‚           â”‚   â”œâ”€â”€ Google Pay Button
â”‚           â”‚   â”œâ”€â”€ COD Button
â”‚           â”‚   â”œâ”€â”€ Card Button
â”‚           â”‚   â””â”€â”€ UPI Button
â”‚           â”‚
â”‚           â”œâ”€â”€ Payment Forms (conditional)
â”‚           â”‚   â”œâ”€â”€ Google Pay Info
â”‚           â”‚   â”œâ”€â”€ COD Info
â”‚           â”‚   â”œâ”€â”€ Card Form
â”‚           â”‚   â””â”€â”€ UPI Form
â”‚           â”‚
â”‚           â””â”€â”€ Place Order Button
â”‚
â”œâ”€â”€ OrderHistory
â”‚   â””â”€â”€ Order List
â”‚       â””â”€â”€ Order Card (multiple)
â”‚           â”œâ”€â”€ Order Details
â”‚           â”œâ”€â”€ Track Order Button
â”‚           â””â”€â”€ Cancel Order Button
â”‚
â””â”€â”€ OrderTracking
    â”œâ”€â”€ Map Panel
    â”‚   â”œâ”€â”€ Google Map
    â”‚   â”œâ”€â”€ Delivery Marker (blue)
    â”‚   â”œâ”€â”€ Destination Marker (red)
    â”‚   â”œâ”€â”€ Route Line
    â”‚   â””â”€â”€ Delivery Person Info
    â”‚
    â””â”€â”€ Details Panel
        â”œâ”€â”€ Order Information
        â”œâ”€â”€ Cancellation Banner (if applicable)
        â”œâ”€â”€ Status Timeline
        â”œâ”€â”€ Order Items
        â”œâ”€â”€ Delivery Address
        â””â”€â”€ Payment Information
```

---

## API Endpoints Structure

```
/api
â”œâ”€â”€ /auth
â”‚   â”œâ”€â”€ POST /register
â”‚   â”œâ”€â”€ POST /login
â”‚   â””â”€â”€ POST /logout
â”‚
â”œâ”€â”€ /products
â”‚   â”œâ”€â”€ GET /
â”‚   â”œâ”€â”€ GET /:id
â”‚   â”œâ”€â”€ POST / (admin)
â”‚   â””â”€â”€ PUT /:id (admin)
â”‚
â”œâ”€â”€ /orders
â”‚   â”œâ”€â”€ GET /                    â† Get user's orders
â”‚   â”œâ”€â”€ POST /                   â† Create new order
â”‚   â”œâ”€â”€ PUT /:id/cancel          â† Cancel order (user)
â”‚   â”œâ”€â”€ GET /all (admin)         â† Get all orders
â”‚   â”œâ”€â”€ PUT /:id/status (admin)  â† Update order status
â”‚   â””â”€â”€ PUT /:id/tracking (admin)â† Update delivery tracking
â”‚
â””â”€â”€ /cart
    â”œâ”€â”€ GET /
    â”œâ”€â”€ POST /items
    â”œâ”€â”€ PUT /items/:productId
    â””â”€â”€ DELETE /items/:productId
```

---

## State Management Flow

```
AppContext (Global State)
â”œâ”€â”€ products: []
â”œâ”€â”€ cart: []
â”œâ”€â”€ orders: []
â”œâ”€â”€ currentUser: {}
â””â”€â”€ dispatch()
    â”œâ”€â”€ ADD_TO_CART
    â”œâ”€â”€ REMOVE_FROM_CART
    â”œâ”€â”€ UPDATE_CART_QUANTITY
    â”œâ”€â”€ CLEAR_CART
    â”œâ”€â”€ ADD_ORDER
    â”œâ”€â”€ UPDATE_ORDER_STATUS
    â”œâ”€â”€ CANCEL_ORDER
    â”œâ”€â”€ LOGIN
    â””â”€â”€ LOGOUT

LocalStorage Sync
â”œâ”€â”€ elitestore_cart
â”œâ”€â”€ elitestore_orders
â”œâ”€â”€ elitestore_currentUser
â””â”€â”€ Auto-save on state change
```

---

## Security Considerations

### Frontend Security
```
âœ… API keys in environment variables
âœ… No sensitive data in localStorage
âœ… Payment tokens never stored
âœ… HTTPS required for production
âœ… Input validation on all forms
```

### Backend Security
```
âœ… JWT authentication
âœ… User authorization checks
âœ… Payment token validation
âœ… Cancellation window verification
âœ… Admin-only endpoints protected
âœ… Rate limiting on API calls
```

### Payment Security
```
âœ… Google Pay tokenization
âœ… No card details stored
âœ… PCI DSS compliance
âœ… Encrypted communication
âœ… Secure payment gateway
```

---

## Performance Optimization

### Frontend
```
âœ… Lazy load Google Maps
âœ… Lazy load Google Pay SDK
âœ… Debounce location updates
âœ… Cache map instances
âœ… Optimize re-renders
```

### Backend
```
âœ… Index on order status
âœ… Index on user ID
âœ… Index on creation date
âœ… Pagination for order lists
âœ… Efficient queries
```

### Maps
```
âœ… Load maps only when needed
âœ… Reuse map instances
âœ… Limit tracking updates
âœ… Optimize marker rendering
âœ… Cache geocoding results
```

---

This architecture provides a scalable, secure, and user-friendly e-commerce platform with modern payment and tracking features! ğŸš€